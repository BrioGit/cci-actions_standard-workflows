on:
  workflow_call:
    inputs:
      cumulusci-version:
        required: false
        type: string
      sfdx-version:
        required: false
        type: string
      org-name:
        required: false
        type: string
        default: dev
    secrets:
      dev-hub-auth-url:
        required: true

jobs:
  project-info:
    name: "project-info"
    runs-on: ubuntu-latest
    steps:
      - uses: nimba-actions/run-flow-scratch@v1 
        with:
          dev-hub-auth-url: '${{ secrets.dev-hub-auth-url }}'
          org-name: '${{ inputs.org-name }}'
          cumulusci-version: '${{ inputs.cumulusci-version }}'
          sfdx-version: '${{ inputs.sfdx-version }}'
          flow-name: cci_project_info
          
  feature-test:
    name: "Feature Test (Namespaced Org)"
    runs-on: ubuntu-latest
    steps:
      - uses: nimba-actions/feature-test-namespaced@v1
        with:
          dev-hub-auth-url: '${{ secrets.dev-hub-auth-url }}'
          cumulusci-version: '${{ inputs.cumulusci-version }}'
          sfdx-version: '${{ inputs.sfdx-version }}'
  
  build-feature-test-package:
    name: "Build Feature Test Package"
    runs-on: ubuntu-latest
    steps:
      - uses: nimba-solutions/build-feature-test-package@v1
        with:
          dev-hub-auth-url: ${{ secrets.dev-hub-auth-url }}
          cumulusci-version: '${{ inputs.cumulusci-version }}'
          sfdx-version: '${{ inputs.sfdx-version }}'
          
  feature-test-2gp:
    name: "Feature Test - 2GP"
    runs-on: ubuntu-latest
    needs:
      - build-feature-test-package
    steps:
      - uses: nimba-actions/feature-test-2gp@v1
        with:
          dev-hub-auth-url: ${{ secrets.dev-hub-auth-url }}
          cumulusci-version: '${{ inputs.cumulusci-version }}'
          sfdx-version: '${{ inputs.sfdx-version }}'
